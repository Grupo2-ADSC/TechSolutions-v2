<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/cssSite/cadastro.css">
    <link rel="stylesheet" href="css/cssSite/header.css">
    <link rel="icon" href="assets/iconCafe.png">
    <title>Cadastro | TechSolutions</title>

    <!-- LIB DE ICON -->
    <link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
</head>

<body>
    <div class="header">

        <div class="container">

            <img class="logo" src="assets/imgs/LogoTechSolutions.png" alt="Logo da TechSolutions">

            <div class="navbar">

                <ul>
                    <li><a href="index.html"><b>Home</b></a></li> |
                    <li><b>Cadastro</b></li> |
                    <li><a href="login.html"><b>Login </b></a></li> |
                    <li><a href="faleConosco.html"><b>Fale Conosco</b></a></li> |
                    <li><a href="sobreNos.html"><b>Sobre Nós</b></a></li> |
                    <li><b><a href="simulador.html"><b>Simulador</b></a></li>
                </ul>


            </div>

        </div>

    </div>

    <div class="alerta_erro">
        <div class="card_erro" id="cardErro">
            <span id="mensagem_erro"></span>
        </div>
    </div>

    <div class="background">
        <div class="fundoBranco">
            <h1 class="titulo">Cadastro</h1><br>
            <div class="divisao">
                <div class="container1">


                    <p>
                        Senha <br>
                        <input class="input" placeholder=" ********" type="password" id="senha_input"><br>
                        <span id="botaoVerSenha" class="lnr lnr-eye" onclick="verSenha()"></span>
                        <span id="alerta_senha"></span>
                    </p><br>


                    <p>
                        Email <br>
                        <input class="input" placeholder=" cafe@brasil.com" type="text" id="email_input"><br>
                        <span id="alerta_email"></span>
                    </p><br>
                    <p>
                        CNPJ <br>
                        <input class="input" placeholder=" 12.345.678/0009-10" type="text" id="cnpj_input"
                            maxlength="18"><br>
                        <span id="alerta_cnpj"></span>
                    </p><br>

                    <p>
                        Nome da empresa <br>
                        <input class="input" placeholder=" Três Corações" type="text" id="nome_input"><br>
                        <span id="alerta_nome"></span>
                    </p><br>

                    <p>
                        Telefone <br>
                        <input class="input" placeholder=" (11)4455-8899" type="text" id="telefone_input"
                            maxlength="14"><br>
                        <span id="alerta_telefone"></span>
                    </p><br>
                </div>
            </div><br>
            <button class="button2" onclick="cadastrar()">Cadastrar-se</button>
            <a class="link" href="../public/login.html">Já tem cadastro? Faça seu Login</a>
        </div>

    </div>

    <div id="containerFooter">

        <footer id="rodape" class="back-Rodape">
            <ul id="icones" class="back-Rodape">
                <li><a href="#"><img src="./assets/instagram.png" alt="imagem instagram'"></a></li>
                <li><a href="#"><img href="https://wa.me/+5511949591340?text=Olá, vi seu profile card!" target="_blank"
                            src="./assets/whatsapp.png" alt="imagem whatsapp"></a></li>
                <li><a href="https://github.com/Grupo2-ADSC"><img src="./assets/github.png" alt=""></a></li>
            </ul>
            <br>
            <ul id="infos" class="back-Rodape">
                <li><a href="./index.html">Home</a></li> -
                <li><a href="faleConosco.html">Fale Conosco</a></li> -
                <li><a href="sobreNos.html">Sobre Nós</a></li>
            </ul>
            <br>
            <ul id="termos" class="back-Rodape">
                <li>Politica de Privacidade </li> -
                <li>Termos de Uso</li>
            </ul>
            <br>

            <p id="direitos" class="back-Rodape">© 2023 All rights reserved SPTECH - TechSolutions </p>
        </footer>
    </div>

</body>

</html>

<script>
    function cadastrar() {

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var senhaVar = senha_input.value
        var emailVar = email_input.value;
        var cnpjVar = cnpj_input.value;
        var nomeVar = nome_input.value;
        var telefoneVar = telefone_input.value
        
        if (
            senhaVar == "" ||
            emailVar == "" ||
            cnpjVar == "" ||
            nomeVar == "" ||
            telefoneVar == "" 
        ) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Mensagem de erro para todos os campos em branco)";

            finalizarAguardar();
            return false;
        } else {
            setInterval(sumirMensagem, 5000);
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                senhaServer: senhaVar, 
                emailServer: emailVar,
                cnpjServer: cnpjVar,
                nomeServer: nomeVar, 
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                    setTimeout(() => {
                        window.location = "./login.html";
                    }, "2000");

                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

        return false;
    }

    function sumirMensagem() {
        cardErro.style.display = "none";
    }
</script>